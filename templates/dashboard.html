{% extends "layout.html" %}
{% block content %}

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
  <div class="card"><h3>Active Devices</h3><p id="devicesCount">12</p></div>
  <div class="card"><h3>Open Ports</h3><p id="openPorts">38</p></div>
  <div class="card"><h3>Network Risk</h3><p id="riskLevel" class="text-green-400">Low</p></div>
</div>

<div class="bg-gray-900/60 backdrop-blur-xl rounded-2xl border border-gray-800 p-6 shadow-inner">
  <h2 class="text-lg font-semibold text-accent mb-4 flex items-center gap-2">
    <i data-lucide="cpu"></i> Devices
  </h2>
  <table class="min-w-full text-sm text-left text-gray-300">
    <thead class="border-b border-gray-700 dark:text-gray-400 text-gray-600 uppercase text-xs">
      <tr>
        <th class="py-3">IP Address</th>
        <th class="py-3">Hostname</th>
        <th class="py-3">Status</th>
      </tr>
    </thead>
      <tbody id="devicesTable" class="text-gray-700 dark:text-gray-300">
        <tr class="hover:bg-gray-800/40 transition" data-ip="192.168.1.1" data-host="router.local">
          <td class="py-3">192.168.1.1</td>
          <td class="font-medium">router.local</td>
          <td class="text-green-400">Online</td>
        </tr>
        <tr class="hover:bg-gray-800/40 transition" data-ip="192.168.1.23" data-host="laptop.local">
          <td class="py-3">192.168.1.23</td>
          <td class="font-medium">laptop.local</td>
          <td class="text-green-400">Online</td>
        </tr>
        <tr class="hover:bg-gray-800/40 transition" data-ip="192.168.1.45" data-host="phone.local">
          <td class="py-3">192.168.1.45</td>
          <td class="font-medium">phone.local</td>
          <td class="text-yellow-400">Idle</td>
        </tr>
      </tbody>
  </table>
</div>

<style>
  .card {
    background: linear-gradient(145deg, rgba(13,17,28,0.9), rgba(5,7,11,0.9));
    border: 1px solid rgba(0,198,255,0.1);
    border-radius: 1.2rem;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 0 15px rgba(0,198,255,0.08), inset 0 0 10px rgba(255,255,255,0.02);
    transition: all 0.35s ease;
    transform-style: preserve-3d;
  }
  .light .card {
    background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(243,244,246,0.95));
    border: 1px solid rgba(37,99,235,0.1);
    box-shadow: 0 0 15px rgba(37,99,235,0.08), inset 0 0 10px rgba(255,255,255,0.5);
  }
  .card:hover {
    transform: translateY(-8px) scale(1.03);
    border-color: rgba(0,198,255,0.3);
    box-shadow: 0 0 25px rgba(0,198,255,0.3),
                0 0 35px rgba(0,198,255,0.2),
                inset 0 0 15px rgba(0,198,255,0.1);
  }
  .light .card:hover {
    border-color: rgba(37,99,235,0.3);
    box-shadow: 0 0 25px rgba(37,99,235,0.15),
                0 0 35px rgba(37,99,235,0.1),
                inset 0 0 15px rgba(37,99,235,0.05);
  }
  .card h3 {
    color: #9ca3af;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    letter-spacing: 0.05em;
  }
  .light .card h3 {
    color: #4B5563;
  }
  .card p {
    font-size: 2.6rem;
    font-weight: bold;
    transition: all 0.6s ease;
    animation: pulse 3s infinite;
    text-shadow: 0 0 8px rgba(0,198,255,0.4);
  }
  .light .card p {
    text-shadow: 0 0 8px rgba(37,99,235,0.2);
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; text-shadow: 0 0 8px rgba(0,198,255,0.5); }
    50% { opacity: 0.8; text-shadow: 0 0 20px rgba(0,198,255,0.9); }
  }
</style>

<script>
  setInterval(() => {
    const devices = document.getElementById("devicesCount");
    const ports = document.getElementById("openPorts");
    const risk = document.getElementById("riskLevel");

    const deviceNum = Math.floor(10 + Math.random() * 5);
    const portNum = Math.floor(30 + Math.random() * 15);
    const riskText = ["Low", "Medium", "High"][Math.floor(Math.random() * 3)];

    devices.textContent = deviceNum;
    ports.textContent = portNum;
    risk.textContent = riskText;

    risk.className =
      "text-3xl font-bold transition-all duration-500 " +
      (riskText === "High"
        ? "text-red-500"
        : riskText === "Medium"
        ? "text-yellow-400"
        : "text-green-400");
  }, 3000);
</script>

<script>
  // Dashboard: listen for global search events and filter the devices table
  document.addEventListener('globalSearch', (e) => {
    const q = (e.detail && e.detail.query) ? e.detail.query.trim().toLowerCase() : '';
    const tbody = document.getElementById('devicesTable');
    if (!tbody) return;
    const rows = Array.from(tbody.querySelectorAll('tr'));
    if (!q) {
      rows.forEach(r => { r.style.display = ''; r.classList.remove('ring-2','ring-accent'); });
      return;
    }
    rows.forEach(r => {
      const ip = (r.dataset.ip || '').toLowerCase();
      const host = (r.dataset.host || '').toLowerCase();
      const match = ip.includes(q) || host.includes(q);
      r.style.display = match ? '' : 'none';
      if (match) {
        r.classList.add('ring-2','ring-accent');
      } else {
        r.classList.remove('ring-2','ring-accent');
      }
    });
  });
</script>

{% endblock %}
