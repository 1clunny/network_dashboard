<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sentinel Dashboard</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      safelist: ['text-red-500', 'text-yellow-400', 'text-green-400'],
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // Dark theme colors
            dark: {
              bg: '#0B0F19',
              surface: 'rgba(17, 24, 39, 0.6)',
              border: 'rgba(75, 85, 99, 0.6)'
            },
            // Light theme colors
            light: {
              bg: '#F3F4F6',
              surface: 'rgba(255, 255, 255, 0.8)',
              border: 'rgba(209, 213, 219, 0.8)'
            },
            primary: '#2563EB',
            accent: '#00C6FF'
          },
          boxShadow: {
            glow: '0 0 25px rgba(0,198,255,0.2)',
            innerGlow: 'inset 0 0 20px rgba(0,198,255,0.15)',
            'light-glow': '0 0 25px rgba(37,99,235,0.1)'
          },
          borderRadius: {
            xl: '1rem',
            '2xl': '1.5rem'
          }
        }
      }
    }
  </script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      --transition-duration: 0.3s;
    }

    body {
      transition: background-color var(--transition-duration) ease, color var(--transition-duration) ease;
    }

    body.dark {
      background: radial-gradient(circle at top left, #0b0f19, #060910);
    }

    body.light {
      background: radial-gradient(circle at top left, #f3f4f6, #e5e7eb);
    }

    .sidebar {
      transition: transform 0.3s ease, opacity 0.2s ease, background-color var(--transition-duration) ease, border-color var(--transition-duration) ease;
    }

    .sidebar.hidden {
      transform: translateX(-100%);
      opacity: 0;
    }

    /* Theme transitions */
    .theme-transition {
      transition: background-color var(--transition-duration) ease,
                  border-color var(--transition-duration) ease,
                  color var(--transition-duration) ease,
                  box-shadow var(--transition-duration) ease;
    }

    /* Light theme overrides */
    body.light {
      color: #1F2937;
    }

    /* Basic elements */
    body.light .sidebar {
      background: rgba(255, 255, 255, 0.85);
      border-color: rgba(209, 213, 219, 0.5);
      box-shadow: 0 0 25px rgba(37,99,235,0.1);
    }

    /* Background and borders */
    body.light .bg-gray-900\/60 {
      background: rgba(255, 255, 255, 0.85);
    }

    body.light .border-gray-800 {
      border-color: rgba(209, 213, 219, 0.5);
    }

    /* Text colors */
    body.light .text-gray-400 {
      color: #6B7280;
    }

    body.light .text-gray-100 {
      color: #1F2937;
    }

    body.light .text-accent {
      color: #2563EB;
    }

    /* Button and interactive elements */
    body.light .bg-gray-800\/60 {
      background: rgba(243, 244, 246, 0.8);
    }

    body.light .hover\:bg-gray-800:hover {
      background: rgba(229, 231, 235, 0.9);
    }

    /* Card and container effects */
    body.light .backdrop-blur-xl {
      backdrop-filter: blur(20px) brightness(1.1);
    }

    /* Status colors */
    body.light .bg-green-500\/10 {
      background: rgba(16, 185, 129, 0.1);
    }

    body.light .bg-red-500\/10 {
      background: rgba(239, 68, 68, 0.1);
    }

    body.light .bg-yellow-500\/10 {
      background: rgba(245, 158, 11, 0.1);
    }

    body.light .bg-blue-500\/10 {
      background: rgba(59, 130, 246, 0.1);
    }

    /* Border colors for status elements */
    body.light .border-red-500\/20 {
      border-color: rgba(239, 68, 68, 0.2);
    }

    body.light .border-green-500\/20 {
      border-color: rgba(16, 185, 129, 0.2);
    }

    /* Shadow effects */
    body.light .shadow-glow {
      box-shadow: 0 0 25px rgba(37,99,235,0.1);
    }

    body.light .hover\:shadow-glow:hover {
      box-shadow: 0 0 30px rgba(37,99,235,0.15);
    }

    /* Input and form elements */
    body.light input, 
    body.light select {
      background: rgba(255, 255, 255, 0.8);
      border-color: rgba(209, 213, 219, 0.8);
    }

    body.light input:focus,
    body.light select:focus {
      border-color: #2563EB;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.1);
    }

    /* Progress bars and indicators */
    body.light .scan-progress {
      background: linear-gradient(90deg, #2563eb, #60a5fa);
    }

    /* Hover effects */
    body.light .hover\:bg-gray-800\/60:hover {
      background: rgba(243, 244, 246, 0.9);
    }

    /* Icons */
    body.light [data-lucide] {
      stroke-width: 1.5px;
    }

    /* Theme toggle button */
    body.light #themeToggle {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(209, 213, 219, 0.8);
      color: #2563EB;
    }

    body.light #themeToggle:hover {
      box-shadow: 0 0 15px rgba(37,99,235,0.2);
    }
    
    /* Global search smoothing to avoid pixelation on focus/press */
    #globalSearch {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      transform: translateZ(0);
      will-change: box-shadow, transform, background-color;
      transition: box-shadow 180ms ease, background-color 180ms ease, border-color 180ms ease, transform 180ms ease;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
      outline: none;
    }

    #globalSearch:focus {
      box-shadow: 0 10px 30px rgba(37,99,235,0.08), 0 0 0 4px rgba(37,99,235,0.06);
      border-color: rgba(37,99,235,0.6);
      transform: translateZ(0) scale(1.0);
    }

    /* Slightly different focus look for dark theme to keep contrast */
    body.dark #globalSearch {
      box-shadow: 0 1px 0 rgba(255,255,255,0.02);
    }

    body.dark #globalSearch:focus {
      /* Softer cyan glow for dark theme to match light theme's pressed effect */
      box-shadow: 0 8px 28px rgba(2,132,199,0.12), /* soft outer blur */
                  0 0 0 6px rgba(2,132,199,0.08), /* subtle halo */
                  0 1px 0 rgba(255,255,255,0.02); /* slight top highlight */
      border-color: rgba(2,132,199,0.6);
      transform: translateZ(0) scale(1.01);
    }

    /* Select/option color fixes for dark/light themes */
    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    body.dark select, body.dark select:focus {
      background: rgba(11,17,25,0.8) !important;
      color: #E6F6FF !important;
      border-color: rgba(2,132,199,0.25) !important;
    }
    body.dark select option {
      background: #0b1220 !important;
      color: #E6F6FF !important;
    }
    body.light select, body.light select:focus {
      background: rgba(255,255,255,0.95) !important;
      color: #1F2937 !important;
      border-color: rgba(209,213,219,0.8) !important;
    }
    body.light select option {
      background: #ffffff !important;
      color: #1F2937 !important;
    }

    /* Strong visual styles for selected scan intensity buttons to ensure consistent appearance */
    .intensityBtn.selected,
    .intensityBtn.bg-accent.selected {
      background: linear-gradient(90deg, #2563EB, #00C6FF) !important;
      color: #000 !important;
      box-shadow: 0 10px 30px rgba(37,99,235,0.12) !important;
      transform: translateY(-2px) !important;
    }
    body.dark .intensityBtn.selected,
    body.dark .intensityBtn.bg-accent.selected {
      box-shadow: 0 10px 30px rgba(2,132,199,0.12) !important;
    }
  </style>
</head>

<body class="text-gray-100 min-h-screen flex bg-bg dark theme-transition">
  <!-- Theme Toggle -->
  <button id="themeToggle" class="fixed top-4 right-4 z-50 p-2 rounded-full theme-transition bg-gray-900/50 backdrop-blur-xl border border-gray-800 hover:shadow-glow">
    <!-- Sun icon -->
    <svg id="sunIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
    </svg>
    <!-- Moon icon -->
    <svg id="moonIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
    </svg>
  </button>

  <!-- SIDEBAR -->
  <aside id="sidebar" class="sidebar fixed md:static z-50 w-64 md:w-64 bg-gray-900/50 backdrop-blur-xl border-r border-gray-800 flex flex-col items-start p-4 space-y-8 shadow-glow min-h-screen theme-transition">
    <div class="flex items-center justify-between w-full">
      <div class="flex items-center gap-3">
        <img src="{{ url_for('static', filename='logo.png') }}" class="w-10 h-10 rounded-xl" alt="Sentinel Logo" />
        <span class="text-xl font-bold bg-gradient-to-r from-accent to-blue-500 bg-clip-text text-transparent">SENTINEL</span>
      </div>
      <button id="closeMenu" class="md:hidden p-2 hover:bg-gray-800 rounded-lg transition">
        <i data-lucide="x"></i>
      </button>
    </div>

    <nav class="flex flex-col space-y-3 w-full mt-4">
      <a href="/" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-800/60 transition group">
        <i data-lucide="layout-dashboard" class="w-5 h-5 text-accent group-hover:scale-110 transition"></i>
        <span class="text-sm font-medium">Dashboard</span>
      </a>
      <a href="/networks" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-800/60 transition group">
        <i data-lucide="wifi" class="w-5 h-5 text-blue-400 group-hover:scale-110 transition"></i>
        <span class="text-sm font-medium">Networks</span>
      </a>
      <a href="/security" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-800/60 transition group">
        <i data-lucide="shield" class="w-5 h-5 text-green-400 group-hover:scale-110 transition"></i>
        <span class="text-sm font-medium">Security</span>
      </a>
      <a href="/settings" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-800/60 transition group">
        <i data-lucide="settings" class="w-5 h-5 text-gray-400 group-hover:scale-110 transition"></i>
        <span class="text-sm font-medium">Settings</span>
      </a>
      <a href="/logout" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-800/60 transition group text-red-400">
        <i data-lucide="log-out" class="w-5 h-5 group-hover:scale-110 transition"></i>
        <span class="text-sm font-medium">Log Out</span>
      </a>
    </nav>

    <div class="mt-auto w-full">
      <button id="scanBtn" class="scan-btn w-full">
        <span id="scanText">Run Scan</span>
        <div id="scanProgress" class="scan-progress"></div>
      </button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="flex-1 p-8 md:ml-0 ml-0">
    <header class="flex items-center justify-between mb-8 md:hidden">
      <button id="openMenu" class="p-2 bg-gray-900/60 rounded-lg border border-gray-800">
        <i data-lucide="menu"></i>
      </button>
      <h1 class="text-lg font-semibold text-accent">Sentinel</h1>
    </header>

    <!-- Global search (desktop) -->
    <div class="hidden md:flex items-center gap-4 mb-6">
      <div class="relative w-full max-w-md">
   <input id="globalSearch" type="search" placeholder="Search devices, IPs, hostnames..." 
     class="w-full px-4 py-2 rounded-xl bg-white/90 dark:bg-gray-900/40 border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-accent" />
        <button id="clearSearch" class="absolute right-2 top-1/2 -translate-y-1/2 text-sm text-gray-400 hidden">×</button>
      </div>
    </div>

    {% block content %}{% endblock %}
  </main>

  <style>
    .scan-btn {
      position: relative;
      overflow: hidden;
      border: none;
      outline: none;
      padding: 0.8rem 1rem;
      font-weight: 600;
      border-radius: 1rem;
      color: white;
      background: linear-gradient(90deg, #2563eb, #00c6ff);
      box-shadow: 0 0 15px rgba(0,198,255,0.4);
      transition: all 0.3s ease;
    }

    .scan-btn:hover {
      box-shadow: 0 0 25px rgba(0,198,255,0.6);
      transform: translateY(-2px);
    }

    .scan-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      width: 0%;
      background: linear-gradient(90deg, #00c6ff, #2563eb);
      border-radius: 0 0 1rem 1rem;
      box-shadow: 0 0 10px rgba(0,198,255,0.7);
      transition: width 0.1s linear;
    }

    .scan-btn.scanning {
      cursor: wait;
      opacity: 0.9;
    }

    .scan-btn.done {
      background: linear-gradient(90deg, #22c55e, #16a34a);
      box-shadow: 0 0 25px rgba(34,197,94,0.6);
    }
  </style>

  <script>
    lucide.createIcons();

    // Theme Management
    const themeToggle = document.getElementById('themeToggle');
    const sunIcon = document.getElementById('sunIcon');
    const moonIcon = document.getElementById('moonIcon');
    const body = document.body;

    // Theme buttons in settings page
    const darkThemeBtn = document.getElementById('darkThemeBtn');
    const lightThemeBtn = document.getElementById('lightThemeBtn');

    // Custom event for theme changes
    const themeChangeEvent = new Event('themeChange');

    // Function to update theme buttons in settings
    function updateThemeButtons(isDark) {
      if (darkThemeBtn && lightThemeBtn) {
        // Dark theme button
        if (isDark) {
          darkThemeBtn.classList.add('bg-accent', 'text-black');
          darkThemeBtn.classList.remove('bg-gray-800/60', 'hover:bg-gray-800');
        } else {
          darkThemeBtn.classList.remove('bg-accent', 'text-black');
          darkThemeBtn.classList.add('bg-gray-800/60', 'hover:bg-gray-800');
        }

        // Light theme button
        if (!isDark) {
          lightThemeBtn.classList.add('bg-accent', 'text-black');
          lightThemeBtn.classList.remove('bg-gray-800/60', 'hover:bg-gray-800');
        } else {
          lightThemeBtn.classList.remove('bg-accent', 'text-black');
          lightThemeBtn.classList.add('bg-gray-800/60', 'hover:bg-gray-800');
        }
      }
    }

    // Function to set theme
    function setTheme(isDark) {
      if (isDark) {
        body.classList.add('dark');
        body.classList.remove('light');
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      } else {
        body.classList.add('light');
        body.classList.remove('dark');
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
      }
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateThemeButtons(isDark);
      document.dispatchEvent(themeChangeEvent);
    }

    // Initialize theme from localStorage or system preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      setTheme(savedTheme === 'dark');
    } else {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      setTheme(prefersDark);
    }

    // Theme toggle click handler
    themeToggle?.addEventListener('click', () => {
      const isDark = body.classList.contains('dark');
      setTheme(!isDark);
    });

    // Settings page theme buttons click handlers
    darkThemeBtn?.addEventListener('click', () => setTheme(true));
    lightThemeBtn?.addEventListener('click', () => setTheme(false));

    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      if (!localStorage.getItem('theme')) {
        setTheme(e.matches);
      }
    });

    // Initialize theme buttons state
    updateThemeButtons(body.classList.contains('dark'));

    // Sidebar Management
    const sidebar = document.getElementById('sidebar');
    const openMenu = document.getElementById('openMenu');
    const closeMenu = document.getElementById('closeMenu');
    openMenu?.addEventListener('click', () => sidebar.classList.remove('hidden'));
    closeMenu?.addEventListener('click', () => sidebar.classList.add('hidden'));

    // Global search wiring: dispatch a custom event with the query (debounced)
    const globalSearch = document.getElementById('globalSearch');
    const clearSearch = document.getElementById('clearSearch');
    let _searchTimeout = null;
    function emitGlobalSearch(q) {
      const ev = new CustomEvent('globalSearch', { detail: { query: q } });
      document.dispatchEvent(ev);
    }

    if (globalSearch) {
      globalSearch.addEventListener('input', (e) => {
        const q = (e.target.value || '').trim();
        clearSearch.classList.toggle('hidden', q.length === 0);
        if (_searchTimeout) clearTimeout(_searchTimeout);
        _searchTimeout = setTimeout(() => emitGlobalSearch(q.toLowerCase()), 180);
      });

      clearSearch.addEventListener('click', () => {
        globalSearch.value = '';
        clearSearch.classList.add('hidden');
        emitGlobalSearch('');
        globalSearch.focus();
      });
    }

    // SCAN BUTTON
    const scanBtn = document.getElementById('scanBtn');
    const scanProgress = document.getElementById('scanProgress');
    const scanText = document.getElementById('scanText');

    if (scanBtn) {
      scanBtn.addEventListener('click', () => {
        if (scanBtn.classList.contains('scanning')) return;

        scanBtn.classList.add('scanning');
        scanText.textContent = 'Scanning...';
        scanProgress.style.width = '0%';

        let progress = 0;
        const interval = setInterval(() => {
          progress += Math.random() * 10;
          scanProgress.style.width = `${Math.min(progress, 100)}%`;

          if (progress >= 100) {
            clearInterval(interval);
            scanBtn.classList.remove('scanning');
            scanBtn.classList.add('done');
            scanText.textContent = '✓ Scan Complete';
            setTimeout(() => {
              scanBtn.classList.remove('done');
              scanText.textContent = 'Run Scan';
              scanProgress.style.width = '0%';
            }, 2500);
          }
        }, 300);
      });
    }
  </script>
</body>
</html>